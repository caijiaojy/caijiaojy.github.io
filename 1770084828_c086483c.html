<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>待办清单</title>
  <style>
    :root {
      --bg: #f7f7f9;
      --card: #ffffff;
      --text: #222;
      --muted: #666;
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --border: #e5e7eb;
      --danger: #ef4444;
      --success: #16a34a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, "Helvetica Neue", sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, #eef2ff, #f7f7f9 35%);
      min-height: 100vh;
    }
    .app {
      max-width: 680px;
      margin: 48px auto;
      padding: 0 16px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      overflow: hidden;
    }
    .header {
      padding: 20px 20px 8px;
      border-bottom: 1px solid var(--border);
    }
    .title {
      margin: 0 0 8px;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }
    .form {
      display: flex;
      gap: 8px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: #fbfbfe;
    }
    .input {
      flex: 1;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      outline: none;
      transition: box-shadow .15s, border-color .15s;
      background: #fff;
    }
    .input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59,130,246,.15);
    }
    .btn {
      padding: 12px 16px;
      border: 1px solid var(--primary);
      background: var(--primary);
      color: #fff;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: background .15s, transform .05s;
      white-space: nowrap;
    }
    .btn:hover { background: var(--primary-600); }
    .btn:active { transform: translateY(1px); }
    .filters {
      display: flex;
      gap: 8px;
      padding: 12px 20px;
      align-items: center;
      border-bottom: 1px solid var(--border);
      background: #fff;
      flex-wrap: wrap;
    }
    .filters .filter-btn {
      padding: 8px 12px;
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      color: var(--muted);
      transition: all .15s;
    }
    .filters .filter-btn:hover { border-color: var(--primary); color: var(--primary-600); }
    .filters .filter-btn.active {
      color: #fff;
      background: var(--primary);
      border-color: var(--primary);
    }
    .summary {
      margin-left: auto;
      font-size: 12px;
      color: var(--muted);
    }
    .list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      gap: 12px;
    }
    .item:last-child { border-bottom: none; }
    .left {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
      flex: 1;
    }
    .checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--success);
    }
    .text {
      flex: 1;
      word-break: break-word;
      line-height: 1.4;
    }
    .item.completed .text {
      text-decoration: line-through;
      color: var(--muted);
    }
    .delete {
      border: none;
      background: transparent;
      color: var(--danger);
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 6px 8px;
      border-radius: 8px;
      transition: background .15s, transform .05s;
    }
    .delete:hover { background: rgba(239,68,68,0.12); }
    .delete:active { transform: translateY(1px); }
    .empty {
      padding: 28px 20px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }
    .footer {
      padding: 14px 20px;
      border-top: 1px solid var(--border);
      background: #fafafa;
      color: var(--muted);
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hint { color: var(--muted); }
    @media (max-width: 480px) {
      .app { margin: 24px auto; }
      .filters { gap: 6px; }
      .summary { width: 100%; margin-top: 6px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" role="application" aria-label="待办清单应用">
      <div class="header">
        <h1 class="title">待办清单</h1>
        <p class="subtitle">添加你的任务，点击复选框标记完成，使用筛选查看不同状态。</p>
      </div>

      <form class="form" id="todo-form" autocomplete="off">
        <input id="todo-input" class="input" type="text" placeholder="输入待办事项，按 Enter 或点击添加" aria-label="待办输入框" />
        <button type="submit" class="btn" aria-label="添加待办">添加</button>
      </form>

      <div class="filters" role="group" aria-label="筛选">
        <button class="filter-btn active" data-filter="all" aria-pressed="true">全部</button>
        <button class="filter-btn" data-filter="active" aria-pressed="false">未完成</button>
        <button class="filter-btn" data-filter="completed" aria-pressed="false">已完成</button>
        <div class="summary" id="summary" aria-live="polite"></div>
      </div>

      <ul class="list" id="todo-list" aria-live="polite"></ul>

      <div class="footer">
        <span class="hint">提示：刷新页面后数据仍会保留（localStorage）。</span>
        <span id="persist" class="hint"></span>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const STORAGE_KEY = 'todos-app-v1';
      let todos = [];
      let filter = 'all';

      const $ = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));
      const form = $('#todo-form');
      const input = $('#todo-input');
      const list = $('#todo-list');
      const summary = $('#summary');
      const persist = $('#persist');

      function uuid() {
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        return 'id-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2, 8);
      }

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const data = JSON.parse(raw);
          if (Array.isArray(data.todos)) todos = data.todos.map(t => ({
            id: String(t.id || uuid()),
            text: String(t.text || ''),
            completed: !!t.completed
          }));
          filter = ['all','active','completed'].includes(data.filter) ? data.filter : 'all';
        } catch (e) {
          console.warn('读取本地数据失败：', e);
        }
      }

      function save() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({ todos, filter }));
          persist.textContent = '已保存';
          clearTimeout(save._t);
          save._t = setTimeout(() => persist.textContent = '', 1200);
        } catch (e) {
          console.warn('保存本地数据失败：', e);
          persist.textContent = '保存失败';
        }
      }

      function setFilter(next) {
        filter = next;
        render();
      }

      function addTodo(text) {
        const t = text.trim();
        if (!t) return;
        todos.unshift({ id: uuid(), text: t, completed: false });
        render();
        input.value = '';
        input.focus();
      }

      function toggleTodo(id) {
        const idx = todos.findIndex(t => t.id === id);
        if (idx >= 0) {
          todos[idx].completed = !todos[idx].completed;
          render();
        }
      }

      function deleteTodo(id) {
        const before = todos.length;
        todos = todos.filter(t => t.id !== id);
        if (todos.length !== before) render();
      }

      function getFilteredTodos() {
        switch (filter) {
          case 'active': return todos.filter(t => !t.completed);
          case 'completed': return todos.filter(t => t.completed);
          default: return todos;
        }
      }

      function render() {
        // Filter buttons state
        $$('.filter-btn').forEach(btn => {
          const active = btn.dataset.filter === filter;
          btn.classList.toggle('active', active);
          btn.setAttribute('aria-pressed', active ? 'true' : 'false');
        });

        // List
        const items = getFilteredTodos();
        list.innerHTML = '';
        if (items.length === 0) {
          const li = document.createElement('li');
          li.className = 'empty';
          li.textContent = '这里暂时没有待办事项';
          list.appendChild(li);
        } else {
          const frag = document.createDocumentFragment();
          items.forEach(t => {
            const li = document.createElement('li');
            li.className = 'item' + (t.completed ? ' completed' : '');
            li.dataset.id = t.id;

            const left = document.createElement('div');
            left.className = 'left';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'checkbox';
            checkbox.checked = !!t.completed;
            checkbox.setAttribute('aria-label', '标记完成');

            const span = document.createElement('span');
            span.className = 'text';
            span.textContent = t.text;

            left.appendChild(checkbox);
            left.appendChild(span);

            const del = document.createElement('button');
            del.className = 'delete';
            del.title = '删除这条待办';
            del.setAttribute('aria-label', '删除');
            del.textContent = '×';

            li.appendChild(left);
            li.appendChild(del);
            frag.appendChild(li);
          });
          list.appendChild(frag);
        }

        // Summary
        const total = todos.length;
        const leftCount = todos.filter(t => !t.completed).length;
        const done = total - leftCount;
        summary.textContent = `共 ${total} 条 · 未完成 ${leftCount} 条 · 已完成 ${done} 条`;

        save();
      }

      // Events
      form.addEventListener('submit', e => {
        e.preventDefault();
        addTodo(input.value);
      });

      list.addEventListener('change', e => {
        const target = e.target;
        if (target.classList.contains('checkbox')) {
          const li = target.closest('.item');
          if (li) toggleTodo(li.dataset.id);
        }
      });

      list.addEventListener('click', e => {
        const target = e.target;
        if (target.classList.contains('delete')) {
          const li = target.closest('.item');
          if (li) deleteTodo(li.dataset.id);
        }
      });

      $$('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => setFilter(btn.dataset.filter));
      });

      // Initial
      load();
      render();
    })();
  </script>
</body>
</html>