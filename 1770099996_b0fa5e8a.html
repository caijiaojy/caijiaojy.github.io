<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>简易代办清单</title>
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #fff;
      --text: #1f2330;
      --muted: #6b7280;
      --primary: #4f46e5;
      --primary-600: #4338ca;
      --border: #e5e7eb;
      --success: #10b981;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      background: linear-gradient(180deg, #f0f3ff, #f8f9fb 40%);
      color: var(--text);
      min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
    }
    .app {
      width: 92vw; max-width: 720px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(31,35,48,0.08);
      overflow: hidden;
    }
    header {
      padding: 20px 24px 12px;
      background: radial-gradient(1200px 1200px at -10% -20%, #eaefff 0%, transparent 60%), var(--card);
      border-bottom: 1px solid var(--border);
    }
    header h1 {
      margin: 0; font-size: 20px; font-weight: 700; letter-spacing: 0.2px;
      display: flex; align-items: center; gap: 10px;
    }
    header h1 .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: linear-gradient(145deg, var(--primary), #7c6cff);
      box-shadow: 0 0 0 3px rgba(79,70,229,0.12);
    }
    .form {
      padding: 16px 24px; display: flex; gap: 10px;
      border-bottom: 1px solid var(--border);
    }
    .form input {
      flex: 1; padding: 12px 14px; font-size: 16px; border-radius: 10px;
      border: 1px solid var(--border); outline: none; background: #fafbff;
    }
    .form input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79,70,229,0.08); }
    .form button {
      padding: 12px 16px; border: none; border-radius: 10px; cursor: pointer;
      background: var(--primary); color: #fff; font-weight: 600;
      transition: transform .06s ease, background .15s ease;
    }
    .form button:active { transform: scale(0.98); }
    .form button:hover { background: var(--primary-600); }

    .filters {
      padding: 10px 24px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
    }
    .filters button {
      padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border);
      background: #fff; color: var(--text); cursor: pointer; font-size: 14px;
    }
    .filters button.active {
      background: #eef2ff; color: var(--primary);
      border-color: rgba(79,70,229,0.35);
    }

    .list { padding: 6px 8px; max-height: 60vh; overflow: auto; }
    ul { list-style: none; margin: 0; padding: 0; }
    li.todo {
      display: flex; align-items: center; gap: 12px;
      padding: 10px 12px; margin: 8px; border: 1px solid var(--border); border-radius: 12px;
      background: #fff; transition: border-color .15s ease, background .15s ease;
    }
    li.todo:hover { border-color: #d9dce4; }
    .checkbox {
      width: 20px; height: 20px; border-radius: 6px; border: 2px solid #cbd5e1; display: inline-flex;
      align-items: center; justify-content: center; cursor: pointer; flex: 0 0 auto; background:#fff;
    }
    .checkbox.checked { border-color: var(--success); background: #ecfdf5; }
    .checkbox .tick {
      width: 12px; height: 12px; display: none; color: var(--success);
    }
    .checkbox.checked .tick { display: block; }
    .text {
      flex: 1; line-height: 1.4; word-break: break-word;
    }
    .completed .text {
      color: var(--muted); text-decoration: line-through;
    }
    .actions { display: flex; gap: 6px; }
    .btn {
      border: 1px solid var(--border); background: #fff; color: var(--text); padding: 6px 10px;
      border-radius: 8px; cursor: pointer; font-size: 13px;
    }
    .btn:hover { background: #f8f9fb; }
    .btn.danger { color: var(--danger); border-color: #f2c7c7; background: #fff; }
    .btn.danger:hover { background: #fff5f5; }

    .empty {
      text-align: center; color: var(--muted); padding: 28px 12px;
    }

    footer {
      padding: 12px 24px; font-size: 13px; color: var(--muted);
      border-top: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      flex-wrap: wrap;
    }
    .count strong { color: var(--text); }
  </style>
</head>
<body>
  <main class="app" aria-label="代办清单应用">
    <header>
      <h1><span class="dot" aria-hidden="true"></span> 代办清单</h1>
    </header>

    <section class="form" aria-label="添加待办">
      <input id="todo-input" type="text" placeholder="输入待办事项，按 Enter 或点击添加…" autocomplete="off" />
      <button id="add-btn" type="button" aria-label="添加">添加</button>
    </section>

    <nav class="filters" aria-label="筛选">
      <button class="filter-btn" data-filter="all">全部</button>
      <button class="filter-btn" data-filter="active">进行中</button>
      <button class="filter-btn" data-filter="completed">已完成</button>
    </nav>

    <section class="list" aria-live="polite">
      <ul id="todo-list"></ul>
      <div id="empty" class="empty" hidden>暂无事项，开始添加吧！</div>
    </section>

    <footer>
      <div class="count">剩余 <strong id="left-count">0</strong> 项进行中</div>
      <button id="clear-completed" class="btn" type="button">清除已完成</button>
    </footer>
  </main>

  <script>
    (function() {
      const STORAGE_KEY = 'todos:v1';
      const FILTER_KEY = 'todos:filter';
      const $input = document.getElementById('todo-input');
      const $add = document.getElementById('add-btn');
      const $list = document.getElementById('todo-list');
      const $empty = document.getElementById('empty');
      const $count = document.getElementById('left-count');
      const $filters = document.querySelectorAll('.filter-btn');
      const $clearCompleted = document.getElementById('clear-completed');

      let todos = [];
      let currentFilter = 'all';

      // 初始化
      load();
      render();
      updateFilterButtons();

      // 事件绑定
      $add.addEventListener('click', onAdd);
      $input.addEventListener('keydown', e => {
        if (e.key === 'Enter') onAdd();
      });
      $list.addEventListener('click', onListClick);
      document.querySelector('.filters').addEventListener('click', onFilterClick);
      $clearCompleted.addEventListener('click', clearCompleted);
      window.addEventListener('storage', e => {
        if (e.key === STORAGE_KEY || e.key === FILTER_KEY) {
          load();
          updateFilterButtons();
          render();
        }
      });

      // 加载本地数据
      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          todos = Array.isArray(JSON.parse(raw)) ? JSON.parse(raw) : [];
        } catch { todos = []; }
        try {
          const f = localStorage.getItem(FILTER_KEY);
          if (f) currentFilter = f;
        } catch { currentFilter = 'all'; }
      }
      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
      }
      function saveFilter() {
        localStorage.setItem(FILTER_KEY, currentFilter);
      }

      function onAdd() {
        const text = ($input.value || '').trim();
        if (!text) {
          $input.focus();
          return;
        }
        const id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now().toString(36) + Math.random().toString(36).slice(2,7));
        todos.unshift({ id, text, completed: false });
        $input.value = '';
        save();
        render();
        $input.focus();
      }

      function onListClick(e) {
        const li = e.target.closest('li.todo');
        if (!li) return;
        const id = li.dataset.id;

        if (e.target.classList.contains('checkbox') || e.target.closest('.checkbox')) {
          toggleCompleted(id);
          return;
        }
        if (e.target.classList.contains('delete-btn')) {
          removeTodo(id);
          return;
        }
      }

      function onFilterClick(e) {
        const btn = e.target.closest('.filter-btn');
        if (!btn) return;
        currentFilter = btn.dataset.filter;
        saveFilter();
        updateFilterButtons();
        render();
      }

      function toggleCompleted(id) {
        const t = todos.find(item => item.id === id);
        if (!t) return;
        t.completed = !t.completed;
        save();
        render();
      }

      function removeTodo(id) {
        const idx = todos.findIndex(item => item.id === id);
        if (idx >= 0) {
          todos.splice(idx, 1);
          save();
          render();
        }
      }

      function clearCompleted() {
        const before = todos.length;
        todos = todos.filter(t => !t.completed);
        if (todos.length !== before) {
          save();
          render();
        }
      }

      function getFilteredTodos() {
        switch (currentFilter) {
          case 'active': return todos.filter(t => !t.completed);
          case 'completed': return todos.filter(t => t.completed);
          default: return todos;
        }
      }

      function render() {
        const items = getFilteredTodos();
        $list.innerHTML = '';
        if (items.length === 0) {
          $empty.hidden = false;
        } else {
          $empty.hidden = true;
          const frag = document.createDocumentFragment();
          items.forEach(t => {
            const li = document.createElement('li');
            li.className = 'todo' + (t.completed ? ' completed' : '');
            li.dataset.id = t.id;

            const checkbox = document.createElement('div');
            checkbox.className = 'checkbox' + (t.completed ? ' checked' : '');
            checkbox.setAttribute('role', 'checkbox');
            checkbox.setAttribute('aria-checked', t.completed ? 'true' : 'false');
            const tick = document.createElementNS('http://www.w3.org/2000/svg','svg');
            tick.setAttribute('viewBox','0 0 24 24');
            tick.setAttribute('class','tick');
            tick.innerHTML = '<path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            checkbox.appendChild(tick);

            const text = document.createElement('div');
            text.className = 'text';
            text.textContent = t.text;

            const actions = document.createElement('div');
            actions.className = 'actions';
            const del = document.createElement('button');
            del.type = 'button';
            del.className = 'btn danger delete-btn';
            del.textContent = '删除';
            actions.appendChild(del);

            li.appendChild(checkbox);
            li.appendChild(text);
            li.appendChild(actions);
            frag.appendChild(li);
          });
          $list.appendChild(frag);
        }
        const left = todos.filter(t => !t.completed).length;
        $count.textContent = left.toString();
      }

      function updateFilterButtons() {
        $filters.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.filter === currentFilter);
        });
      }
    })();
  </script>
</body>
</html>